\chapter{Derivation of extraction efficiency equation}
\label{appex:extraction-efficiency}

Consider a material containing $m_0$ grams of element $X$. Suppose we apply
a process to this material, and let the extraction efficiency for element $X$ be
$\epsilon_{X}$. The mass of element $X$ remaining in the material after applying
the process, $m_{1}$ is
\begin{equation}
   m_{1} = m_0(1-\epsilon_{X}) 
\end{equation}

Suppose now that we apply the same process to the material a second time. The mass of element $X$ remaining in the material, $m_{2}$ is 
\begin{equation}
    m_{2} = m_{1}(1-\epsilon_{X}) = m_0(1-\epsilon_{X})^{2}
\end{equation}

It follows by induction that the leftover mass of element $X$ after applying this
process $n$ times is
\begin{equation}
    m_{n} = m_0(1-\epsilon_{X})^{n}
\end{equation}

Now, let $\delta \equiv \frac{m_{n}}{m_0}$, the fraction of the original mass of
element $X$ remaining in the material. Suppose we pick a process that represents
a chemical process with a cycle time\footnote{the amount of time it takes
to remove 100\% of the element} of $c_{x}$ for element $X$. Let $t$ be a value
of time between 0 and $c_{x}$, and let $n \equiv \frac{c_{x}}{t_\text{step}}$ be
the number of times we apply our process to the material. Then, at time $t$, the
fraction of mass of element $X$ remaining in the material is given by

\begin{equation}
    \delta = (1-\epsilon_{x})^{\frac{c_{x}}{t}}
\end{equation}

Consider the case where $t=c_{x}$. There is no value of $\epsilon_{x} < 1$ that
gives $\delta = 0$. It is also very difficult to separate 100\% of a substance
from a material in chemistry, so a natural solution arises in assigning a small,
nonzero value to $\delta$ as a constraint to obtain a separation efficiency.
Rearranging our equation, we get

\begin{equation}
    \epsilon_{x} = 1 - \delta^{\frac{t}{c_{x}}}
\end{equation}

If $t$ is greater than $c_{x}$, then the above equation no longer applies and we simply assign $\epsilon_{x} = 1$

\chapter{SaltProc input file structure}
\label{appex:input-files}
\definecolor{bg}{rgb}{0.95,0.95,0.95}

The \SaltProc input file has gone through several iterations between version
\verb,0.3.0, and \verb,0.5.0,. Code \ref{code:input-1} shows the structure
of the input file for \SaltProc \verb,v0.3.0,. The input keys are long,
full-sentence descriptions, rather than short keywords. I tried to improve upon
this structure in the input file for \SaltProc \verb,v0.4.0,, seen in
Code \ref{code:input-2}.

\begin{listing}[!ht]
    \begin{minted}[frame=single,
                   framesep=3mm,
                   tabsize=4,
                   bgcolor=bg,
                   fontsize=\footnotesize]{json}
    {
      "Path to Serpent executable": "sss2",
      "File containing processing system objects": "msbr_objects.json",
      "Graph file containing processing system structure": "msbr.dot",
      "User's Serpent input file with reactor model": "msbr.serpent",
      "Path output data storing folder": "../../saltproc/data/",
      "Output HDF5 database file name": "msbr_kl_100_saltproc.h5",
      "Number of neutrons per generation": 50,
      "Number of active generations": 20,
      "Number of inactive generations": 20,
      "Restart simulation from the step when it stopped?": false,
      "Geometry file/files to use in Serpent runs": "geometry/msbr_full.ini",
      "Switch to another geometry when keff drops below 1?": false,
      "Salt mass flow rate throughout reactor core (g/s)": 9920000,
      "Number of steps for constant power and depletion interval case": 12,
      "Depletion step interval or Cumulative time (end of step) (d)": 3,
      "Reactor power or power step list during depletion step (W)": 2250000000
    }
    \end{minted}
    \caption{\SaltProc v0.3.0 input file}
    \label{code:input-1}
\end{listing}

I organized the inputs based on the class they corresponded to in the \SaltProc
code. \verb.depcode. inputs correspond to input files and options used in the
transport-coupled depletion simulation. \verb.simulation. inputs correspond to
simulation metadata (i.e., the simulation name and results file name), as well as
flags to specify certain behaviors (e.g., running the simulation from the most
recent depletion step, switching to another geometry when $k_{\text{eff}}$ drops below
1, etc.). \verb.reactor. inputs correspond to the specifications of the reactor,
such as the volume, mass flowrate, power profile, as well as 
specifying the units and type of timesteps.

\begin{listing}[!ht]
    \begin{minted}[frame=single,
                   framesep=3mm,
                   tabsize=4,
                   bgcolor=bg,
                   fontsize=\footnotesize]{json}
    {
       "proc_input_file": "msbr_objects.json",
       "dot_input_file": "msbr.dot",
       "output_path": "./data",
       "num_depsteps": 12,
       "depcode": {
           "codename": "serpent",
           "exec_path": "sss2",
           "template_inputfile_path": "./msbr.serpent",
           "iter_inputfile": "saltproc_serpent",
           "iter_matfile": "saltproc_mat",
           "npop": 50,
           "active_cycles": 20,
           "inactive_cycles": 20,
           "geo_file_paths": ["./geometry/msbr_full.ini"]
       },
       "simulation": {
           "sim_name": "msbr_example_simulation",
           "db_name": "msbr_kl_100_saltproc.h5",
           "restart_flag": false,
           "adjust_geo": false
       },
       "reactor": {
           "volume": 1.0,
           "mass_flowrate": 9920000,
           "power_levels": [ 2250000000 ],
           "dep_step_length_cumulative": [ 3 ]
       }
    }
    \end{minted}
    \caption{\SaltProc v0.4.0 input file}
    \label{code:input-2}
\end{listing}

I streamlined the \SaltProc \verb,v0.5.0, from the \verb,v0.4.0, one,
removing any options that could be directly specified in the transport code
itself (e.g., neutrons per batch and number of batches). I also removed the
ability to specify the name of the iteration input and material files, opting to
have \SaltProc use hardcoded values for these. I also added support for
\OpenMC input in the \verb.depcode. option.

\begin{listing}[!ht]
    \begin{minted}[frame=single,
                   framesep=3mm,
                   tabsize=4,
                   bgcolor=bg,
                   fontsize=\footnotesize]{json}
    {
       "proc_input_file": "msbr_objects.json",
       "dot_input_file": "msbr.dot",
       "n_depletion_steps": 12,
       "depcode": {
           "codename": "serpent",
           "template_input_file_path": "msbr.serpent",
           "geo_file_paths": ["geometry/msbr_full.ini"]
       },
       "simulation": {
           "sim_name": "msbr_kl_100_simulation"
       },
       "reactor": {
           "volume": 1.0,
           "mass_flowrate": 9920000,
           "power_levels": [ 2250000000 ],
           "depletion_timesteps": [ 3 ],
           "timestep_units": "d"
       }
    }
    \end{minted}
    \caption{\SaltProc v0.5.0 input file}
    \label{code:input-3}
\end{listing}
